# Order Service - –ú–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∑–∞–∫–∞–∑–∞–º–∏ –∏ –∫–æ—Ä–∑–∏–Ω–æ–π

## ‚úÖ –°—Ç–∞—Ç—É—Å

Order Service —É—Å–ø–µ—à–Ω–æ –≤—ã–¥–µ–ª–µ–Ω –≤ –æ—Ç–¥–µ–ª—å–Ω—ã–π –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å –∏ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω!

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

```
API Gateway (HTTP :3000)
    ‚Üì RabbitMQ
Order Service (Microservice)
    ‚îú‚îÄ‚îÄ Order Module (–∑–∞–∫–∞–∑—ã)
    ‚îÇ   ‚îú‚îÄ‚îÄ –°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–∫–∞–∑–æ–≤
    ‚îÇ   ‚îú‚îÄ‚îÄ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞–º–∏
    ‚îÇ   ‚îî‚îÄ‚îÄ –ò—Å—Ç–æ—Ä–∏—è –∑–∞–∫–∞–∑–æ–≤
    ‚îî‚îÄ‚îÄ Cart Module (–∫–æ—Ä–∑–∏–Ω–∞)
        ‚îú‚îÄ‚îÄ –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–æ–≤
        ‚îú‚îÄ‚îÄ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞
        ‚îî‚îÄ‚îÄ –û—á–∏—Å—Ç–∫–∞ –∫–æ—Ä–∑–∏–Ω—ã
```

## üöÄ –ó–∞–ø—É—Å–∫

### 1. –ó–∞–ø—É—Å—Ç–∏—Ç—å –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—É (Docker)

```bash
docker-compose up -d
```

### 2. –ó–∞–ø—É—Å—Ç–∏—Ç—å Order Service

```bash
npm run start:order:dev
```

### 3. –ó–∞–ø—É—Å—Ç–∏—Ç—å API Gateway

```bash
npm run start:dev
```

## üì° API Endpoints

### Orders

- `GET /orders` - –ü–æ–ª—É—á–∏—Ç—å –≤—Å–µ –∑–∞–∫–∞–∑—ã
- `GET /orders/:id` - –ü–æ–ª—É—á–∏—Ç—å –∑–∞–∫–∞–∑ –ø–æ ID
- `GET /orders/user/:userId` - –ü–æ–ª—É—á–∏—Ç—å –∑–∞–∫–∞–∑—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- `POST /orders` - –°–æ–∑–¥–∞—Ç—å –∑–∞–∫–∞–∑
- `PUT /orders/:id` - –û–±–Ω–æ–≤–∏—Ç—å –∑–∞–∫–∞–∑ (—Å—Ç–∞—Ç—É—Å, –∞–¥—Ä–µ—Å)
- `DELETE /orders/:id` - –£–¥–∞–ª–∏—Ç—å –∑–∞–∫–∞–∑

### Cart

- `GET /cart/user/:userId` - –ü–æ–ª—É—á–∏—Ç—å –∫–æ—Ä–∑–∏–Ω—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- `POST /cart/add` - –î–æ–±–∞–≤–∏—Ç—å —Ç–æ–≤–∞—Ä –≤ –∫–æ—Ä–∑–∏–Ω—É
- `PUT /cart/item/:itemId` - –û–±–Ω–æ–≤–∏—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç–æ–≤–∞—Ä–∞
- `DELETE /cart/item/:itemId` - –£–¥–∞–ª–∏—Ç—å —Ç–æ–≤–∞—Ä –∏–∑ –∫–æ—Ä–∑–∏–Ω—ã
- `DELETE /cart/user/:userId/clear` - –û—á–∏—Å—Ç–∏—Ç—å –∫–æ—Ä–∑–∏–Ω—É

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –ü—Ä–∏–º–µ—Ä—ã –∑–∞–ø—Ä–æ—Å–æ–≤

#### –î–æ–±–∞–≤–∏—Ç—å —Ç–æ–≤–∞—Ä –≤ –∫–æ—Ä–∑–∏–Ω—É

```powershell
Invoke-RestMethod -Uri http://localhost:3000/cart/add -Method POST -ContentType "application/json" -Body '{
  "userId": 1,
  "productId": 1,
  "quantity": 2
}'
```

#### –ü–æ–ª—É—á–∏—Ç—å –∫–æ—Ä–∑–∏–Ω—É

```powershell
Invoke-RestMethod -Uri http://localhost:3000/cart/user/1 -Method GET
```

**–û—Ç–≤–µ—Ç:**
```json
{
  "id": 1,
  "userId": 1,
  "items": [
    {
      "id": 1,
      "productId": 1,
      "quantity": 2,
      "price": 899.99,
      "subtotal": 1799.98
    }
  ],
  "totalAmount": 1799.98
}
```

#### –°–æ–∑–¥–∞—Ç—å –∑–∞–∫–∞–∑

```powershell
Invoke-RestMethod -Uri http://localhost:3000/orders -Method POST -ContentType "application/json" -Body '{
  "userId": 1,
  "items": [
    {"productId": 1, "quantity": 2},
    {"productId": 2, "quantity": 1}
  ],
  "shippingAddress": "123 Main St, City, Country",
  "phone": "+1234567890",
  "notes": "Please deliver after 5 PM"
}'
```

**–û—Ç–≤–µ—Ç:**
```json
{
  "id": 1,
  "userId": 1,
  "status": "pending",
  "totalAmount": 2699.97,
  "shippingAddress": "123 Main St, City, Country",
  "phone": "+1234567890",
  "notes": "Please deliver after 5 PM",
  "items": [
    {
      "id": 1,
      "productId": 1,
      "quantity": 2,
      "price": 899.99,
      "subtotal": 1799.98
    },
    {
      "id": 2,
      "productId": 2,
      "quantity": 1,
      "price": 899.99,
      "subtotal": 899.99
    }
  ],
  "createdAt": "2025-10-24T12:00:00.000Z"
}
```

#### –ü–æ–ª—É—á–∏—Ç—å –∑–∞–∫–∞–∑—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

```powershell
Invoke-RestMethod -Uri http://localhost:3000/orders/user/1 -Method GET
```

#### –û–±–Ω–æ–≤–∏—Ç—å —Å—Ç–∞—Ç—É—Å –∑–∞–∫–∞–∑–∞

```powershell
Invoke-RestMethod -Uri http://localhost:3000/orders/1 -Method PUT -ContentType "application/json" -Body '{
  "status": "processing"
}'
```

#### –û–±–Ω–æ–≤–∏—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç–æ–≤–∞—Ä–∞ –≤ –∫–æ—Ä–∑–∏–Ω–µ

```powershell
Invoke-RestMethod -Uri http://localhost:3000/cart/item/1 -Method PUT -ContentType "application/json" -Body '{
  "quantity": 3
}'
```

#### –£–¥–∞–ª–∏—Ç—å —Ç–æ–≤–∞—Ä –∏–∑ –∫–æ—Ä–∑–∏–Ω—ã

```powershell
Invoke-RestMethod -Uri http://localhost:3000/cart/item/1 -Method DELETE
```

#### –û—á–∏—Å—Ç–∏—Ç—å –∫–æ—Ä–∑–∏–Ω—É

```powershell
Invoke-RestMethod -Uri http://localhost:3000/cart/user/1/clear -Method DELETE
```

## üìä RabbitMQ Message Patterns

### Order Patterns

- `get_all_orders` - –ü–æ–ª—É—á–∏—Ç—å –≤—Å–µ –∑–∞–∫–∞–∑—ã
- `get_order` - –ü–æ–ª—É—á–∏—Ç—å –∑–∞–∫–∞–∑ –ø–æ ID
- `get_user_orders` - –ü–æ–ª—É—á–∏—Ç—å –∑–∞–∫–∞–∑—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- `create_order` - –°–æ–∑–¥–∞—Ç—å –∑–∞–∫–∞–∑
- `update_order` - –û–±–Ω–æ–≤–∏—Ç—å –∑–∞–∫–∞–∑
- `delete_order` - –£–¥–∞–ª–∏—Ç—å –∑–∞–∫–∞–∑

### Cart Patterns

- `get_cart` - –ü–æ–ª—É—á–∏—Ç—å –∫–æ—Ä–∑–∏–Ω—É
- `add_to_cart` - –î–æ–±–∞–≤–∏—Ç—å –≤ –∫–æ—Ä–∑–∏–Ω—É
- `update_cart_item` - –û–±–Ω–æ–≤–∏—Ç—å —Ç–æ–≤–∞—Ä –≤ –∫–æ—Ä–∑–∏–Ω–µ
- `remove_cart_item` - –£–¥–∞–ª–∏—Ç—å —Ç–æ–≤–∞—Ä –∏–∑ –∫–æ—Ä–∑–∏–Ω—ã
- `clear_cart` - –û—á–∏—Å—Ç–∏—Ç—å –∫–æ—Ä–∑–∏–Ω—É

## üí° –°—Ç–∞—Ç—É—Å—ã –∑–∞–∫–∞–∑–æ–≤

```typescript
enum E_OrderStatus {
  PENDING = 'pending',       // –û–∂–∏–¥–∞–µ—Ç –æ–±—Ä–∞–±–æ—Ç–∫–∏
  PROCESSING = 'processing', // –í –æ–±—Ä–∞–±–æ—Ç–∫–µ
  SHIPPED = 'shipped',       // –û—Ç–ø—Ä–∞–≤–ª–µ–Ω
  DELIVERED = 'delivered',   // –î–æ—Å—Ç–∞–≤–ª–µ–Ω
  CANCELLED = 'cancelled'    // –û—Ç–º–µ–Ω–µ–Ω
}
```

### –ñ–∏–∑–Ω–µ–Ω–Ω—ã–π —Ü–∏–∫–ª –∑–∞–∫–∞–∑–∞

```
PENDING ‚Üí PROCESSING ‚Üí SHIPPED ‚Üí DELIVERED
   ‚Üì
CANCELLED (–≤–æ–∑–º–æ–∂–Ω–∞ –æ—Ç–º–µ–Ω–∞ –Ω–∞ –ª—é–±–æ–º —ç—Ç–∞–ø–µ)
```

## üîÑ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Product Service

Order Service –∏–Ω—Ç–µ–≥—Ä–∏—Ä—É–µ—Ç—Å—è —Å Product Service –¥–ª—è:

### 1. –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è —Ç–æ–≤–∞—Ä–∞

–ü—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –∑–∞–∫–∞–∑–∞ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è:
- –°—É—â–µ—Å—Ç–≤—É–µ—Ç –ª–∏ —Ç–æ–≤–∞—Ä
- –î–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –ª–∏ —Ç–æ–≤–∞—Ä–∞ –Ω–∞ —Å–∫–ª–∞–¥–µ

```typescript
const productResponse = await productClient.send('get_product', productId);
if (product.stock < quantity) {
  throw new BadRequestException('Insufficient stock');
}
```

### 2. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –æ—Å—Ç–∞—Ç–∫–æ–≤

–ü–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞–∫–∞–∑–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è stock:

```typescript
await productClient.send('update_stock', {
  id: productId,
  quantity: product.stock - orderQuantity
});
```

### 3. –ü–æ–ª—É—á–µ–Ω–∏–µ –∞–∫—Ç—É–∞–ª—å–Ω–æ–π —Ü–µ–Ω—ã

–¶–µ–Ω–∞ –±–µ—Ä–µ—Ç—Å—è –∏–∑ Product Service –≤ –º–æ–º–µ–Ω—Ç —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞–∫–∞–∑–∞:
- –ï—Å–ª–∏ –µ—Å—Ç—å —Å–∫–∏–¥–∫–∞ (`discountPrice`), –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –æ–Ω–∞
- –ò–Ω–∞—á–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –æ–±—ã—á–Ω–∞—è —Ü–µ–Ω–∞ (`price`)

```typescript
const price = product.discountPrice || product.price;
```

## üìù DTO (Data Transfer Objects)

### CreateOrderDto

```typescript
{
  userId: number;              // ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)
  items: OrderItemDto[];       // –¢–æ–≤–∞—Ä—ã –≤ –∑–∞–∫–∞–∑–µ (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)
  shippingAddress: string;     // –ê–¥—Ä–µ—Å –¥–æ—Å—Ç–∞–≤–∫–∏ (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)
  phone: string;               // –¢–µ–ª–µ—Ñ–æ–Ω (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)
  notes?: string;              // –ü—Ä–∏–º–µ—á–∞–Ω–∏—è (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
}
```

### OrderItemDto

```typescript
{
  productId: number;  // ID —Ç–æ–≤–∞—Ä–∞ (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)
  quantity: number;   // –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ, –º–∏–Ω–∏–º—É–º 1 (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)
}
```

### UpdateOrderDto

```typescript
{
  status?: E_OrderStatus;      // –ù–æ–≤—ã–π —Å—Ç–∞—Ç—É—Å
  shippingAddress?: string;    // –ù–æ–≤—ã–π –∞–¥—Ä–µ—Å
  phone?: string;              // –ù–æ–≤—ã–π —Ç–µ–ª–µ—Ñ–æ–Ω
  notes?: string;              // –ù–æ–≤—ã–µ –ø—Ä–∏–º–µ—á–∞–Ω–∏—è
}
```

### AddToCartDto

```typescript
{
  userId: number;      // ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)
  productId: number;   // ID —Ç–æ–≤–∞—Ä–∞ (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)
  quantity: number;    // –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ, –º–∏–Ω–∏–º—É–º 1 (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)
}
```

### UpdateCartItemDto

```typescript
{
  quantity: number;  // –ù–æ–≤–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ, –º–∏–Ω–∏–º—É–º 1 (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)
}
```

## üóÑÔ∏è –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö

### –¢–∞–±–ª–∏—Ü–∞: orders

| –ü–æ–ª–µ | –¢–∏–ø | –û–ø–∏—Å–∞–Ω–∏–µ |
|------|-----|----------|
| id | integer | –ü–µ—Ä–≤–∏—á–Ω—ã–π –∫–ª—é—á |
| user_id | integer | ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è |
| status | enum | –°—Ç–∞—Ç—É—Å –∑–∞–∫–∞–∑–∞ |
| total_amount | decimal | –û–±—â–∞—è —Å—É–º–º–∞ |
| shipping_address | text | –ê–¥—Ä–µ—Å –¥–æ—Å—Ç–∞–≤–∫–∏ |
| phone | varchar | –¢–µ–ª–µ—Ñ–æ–Ω |
| notes | text | –ü—Ä–∏–º–µ—á–∞–Ω–∏—è |
| created_at | timestamp | –î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è |
| updated_at | timestamp | –î–∞—Ç–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è |

### –¢–∞–±–ª–∏—Ü–∞: order_items

| –ü–æ–ª–µ | –¢–∏–ø | –û–ø–∏—Å–∞–Ω–∏–µ |
|------|-----|----------|
| id | integer | –ü–µ—Ä–≤–∏—á–Ω—ã–π –∫–ª—é—á |
| order_id | integer | ID –∑–∞–∫–∞–∑–∞ |
| product_id | integer | ID —Ç–æ–≤–∞—Ä–∞ |
| quantity | integer | –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ |
| price | decimal | –¶–µ–Ω–∞ –Ω–∞ –º–æ–º–µ–Ω—Ç –∑–∞–∫–∞–∑–∞ |
| subtotal | decimal | –°—É–º–º–∞ (price √ó quantity) |

### –¢–∞–±–ª–∏—Ü–∞: carts

| –ü–æ–ª–µ | –¢–∏–ø | –û–ø–∏—Å–∞–Ω–∏–µ |
|------|-----|----------|
| id | integer | –ü–µ—Ä–≤–∏—á–Ω—ã–π –∫–ª—é—á |
| user_id | integer | ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (—É–Ω–∏–∫–∞–ª—å–Ω—ã–π) |
| total_amount | decimal | –û–±—â–∞—è —Å—É–º–º–∞ |
| created_at | timestamp | –î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è |
| updated_at | timestamp | –î–∞—Ç–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è |

### –¢–∞–±–ª–∏—Ü–∞: cart_items

| –ü–æ–ª–µ | –¢–∏–ø | –û–ø–∏—Å–∞–Ω–∏–µ |
|------|-----|----------|
| id | integer | –ü–µ—Ä–≤–∏—á–Ω—ã–π –∫–ª—é—á |
| cart_id | integer | ID –∫–æ—Ä–∑–∏–Ω—ã |
| product_id | integer | ID —Ç–æ–≤–∞—Ä–∞ |
| quantity | integer | –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ |
| price | decimal | –¶–µ–Ω–∞ |
| subtotal | decimal | –°—É–º–º–∞ (price √ó quantity) |

## üîß –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### package.json scripts

```json
"start:order": "nest start order-service",
"start:order:dev": "nest start order-service --watch",
"start:order:prod": "node dist/apps/order-service/main",
"build:order": "nest build order-service"
```

### nest-cli.json

```json
"order-service": {
  "type": "application",
  "root": "apps/order-service",
  "entryFile": "main",
  "sourceRoot": "apps/order-service/src",
  "compilerOptions": {
    "tsConfigPath": "apps/order-service/tsconfig.app.json"
  }
}
```

## üéØ –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞

### –°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–∫–∞–∑–∞

1. **–í–∞–ª–∏–¥–∞—Ü–∏—è —Ç–æ–≤–∞—Ä–æ–≤**
   - –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è –∫–∞–∂–¥–æ–≥–æ —Ç–æ–≤–∞—Ä–∞
   - –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è –Ω–∞ —Å–∫–ª–∞–¥–µ

2. **–†–∞—Å—á–µ—Ç —Å—É–º–º—ã**
   - –ü–æ–ª—É—á–µ–Ω–∏–µ –∞–∫—Ç—É–∞–ª—å–Ω–æ–π —Ü–µ–Ω—ã –∏–∑ Product Service
   - –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ —Å–∫–∏–¥–æ–∫ (–µ—Å–ª–∏ –µ—Å—Ç—å)
   - –ü–æ–¥—Å—á–µ—Ç subtotal –¥–ª—è –∫–∞–∂–¥–æ–π –ø–æ–∑–∏—Ü–∏–∏
   - –ü–æ–¥—Å—á–µ—Ç –æ–±—â–µ–π —Å—É–º–º—ã –∑–∞–∫–∞–∑–∞

3. **–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –æ—Å—Ç–∞—Ç–∫–æ–≤**
   - –£–º–µ–Ω—å—à–µ–Ω–∏–µ stock –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Ç–æ–≤–∞—Ä–∞
   - –û—Ç–ø—Ä–∞–≤–∫–∞ –∑–∞–ø—Ä–æ—Å–∞ –≤ Product Service

4. **–°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–∫–∞–∑–∞**
   - –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∑–∞–∫–∞–∑–∞ —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º `pending`
   - –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø–æ–∑–∏—Ü–∏–π –∑–∞–∫–∞–∑–∞

### –†–∞–±–æ—Ç–∞ —Å –∫–æ—Ä–∑–∏–Ω–æ–π

1. **–î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞**
   - –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è —Ç–æ–≤–∞—Ä–∞
   - –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è –Ω–∞ —Å–∫–ª–∞–¥–µ
   - –ï—Å–ª–∏ —Ç–æ–≤–∞—Ä —É–∂–µ –≤ –∫–æ—Ä–∑–∏–Ω–µ - —É–≤–µ–ª–∏—á–µ–Ω–∏–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞
   - –ò–Ω–∞—á–µ - —Å–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–π –ø–æ–∑–∏—Ü–∏–∏
   - –ü–µ—Ä–µ—Å—á–µ—Ç –æ–±—â–µ–π —Å—É–º–º—ã

2. **–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞**
   - –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è –Ω–∞ —Å–∫–ª–∞–¥–µ
   - –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ subtotal
   - –ü–µ—Ä–µ—Å—á–µ—Ç –æ–±—â–µ–π —Å—É–º–º—ã –∫–æ—Ä–∑–∏–Ω—ã

3. **–£–¥–∞–ª–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞**
   - –£–¥–∞–ª–µ–Ω–∏–µ –ø–æ–∑–∏—Ü–∏–∏ –∏–∑ –∫–æ—Ä–∑–∏–Ω—ã
   - –ü–µ—Ä–µ—Å—á–µ—Ç –æ–±—â–µ–π —Å—É–º–º—ã

4. **–û—á–∏—Å—Ç–∫–∞ –∫–æ—Ä–∑–∏–Ω—ã**
   - –£–¥–∞–ª–µ–Ω–∏–µ –≤—Å–µ—Ö –ø–æ–∑–∏—Ü–∏–π
   - –û–±–Ω—É–ª–µ–Ω–∏–µ –æ–±—â–µ–π —Å—É–º–º—ã

## üîê –í–∞–ª–∏–¥–∞—Ü–∏—è –∏ –æ—à–∏–±–∫–∏

### –ü—Ä–æ–≤–µ—Ä–∫–∏ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –∑–∞–∫–∞–∑–∞

- ‚úÖ –¢–æ–≤–∞—Ä —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
- ‚úÖ –î–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Ç–æ–≤–∞—Ä–∞ –Ω–∞ —Å–∫–ª–∞–¥–µ
- ‚úÖ –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –±–æ–ª—å—à–µ 0
- ‚úÖ –£–∫–∞–∑–∞–Ω –∞–¥—Ä–µ—Å –¥–æ—Å—Ç–∞–≤–∫–∏
- ‚úÖ –£–∫–∞–∑–∞–Ω —Ç–µ–ª–µ—Ñ–æ–Ω

### –í–æ–∑–º–æ–∂–Ω—ã–µ –æ—à–∏–±–∫–∏

```typescript
// –¢–æ–≤–∞—Ä –Ω–µ –Ω–∞–π–¥–µ–Ω
throw new NotFoundException('Product with ID X not found');

// –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Ç–æ–≤–∞—Ä–∞
throw new BadRequestException(
  'Insufficient stock for product. Available: X'
);

// –ó–∞–∫–∞–∑ –Ω–µ –Ω–∞–π–¥–µ–Ω
throw new NotFoundException('Order with ID X not found');

// –ö–æ—Ä–∑–∏–Ω–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞
throw new NotFoundException('Cart not found for user X');
```

## üìà –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –°—Ü–µ–Ω–∞—Ä–∏–π 1: –ü–æ–∫—É–ø–∫–∞ –æ–¥–Ω–æ–≥–æ —Ç–æ–≤–∞—Ä–∞

```bash
# 1. –î–æ–±–∞–≤–∏—Ç—å —Ç–æ–≤–∞—Ä –≤ –∫–æ—Ä–∑–∏–Ω—É
POST /cart/add
{
  "userId": 1,
  "productId": 1,
  "quantity": 1
}

# 2. –°–æ–∑–¥–∞—Ç—å –∑–∞–∫–∞–∑
POST /orders
{
  "userId": 1,
  "items": [{"productId": 1, "quantity": 1}],
  "shippingAddress": "123 Main St",
  "phone": "+1234567890"
}

# –†–µ–∑—É–ª—å—Ç–∞—Ç:
# - –ó–∞–∫–∞–∑ —Å–æ–∑–¥–∞–Ω —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º "pending"
# - Stock —Ç–æ–≤–∞—Ä–∞ —É–º–µ–Ω—å—à–µ–Ω –Ω–∞ 1
# - –ö–æ—Ä–∑–∏–Ω–∞ –º–æ–∂–µ—Ç –±—ã—Ç—å –æ—á–∏—â–µ–Ω–∞
```

### –°—Ü–µ–Ω–∞—Ä–∏–π 2: –ü–æ–∫—É–ø–∫–∞ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö —Ç–æ–≤–∞—Ä–æ–≤

```bash
# 1. –î–æ–±–∞–≤–∏—Ç—å —Ç–æ–≤–∞—Ä—ã –≤ –∫–æ—Ä–∑–∏–Ω—É
POST /cart/add {"userId": 1, "productId": 1, "quantity": 2}
POST /cart/add {"userId": 1, "productId": 2, "quantity": 1}

# 2. –ü—Ä–æ—Å–º–æ—Ç—Ä–µ—Ç—å –∫–æ—Ä–∑–∏–Ω—É
GET /cart/user/1
# –û—Ç–≤–µ—Ç: totalAmount = 2699.97

# 3. –°–æ–∑–¥–∞—Ç—å –∑–∞–∫–∞–∑ –∏–∑ –∫–æ—Ä–∑–∏–Ω—ã
POST /orders
{
  "userId": 1,
  "items": [
    {"productId": 1, "quantity": 2},
    {"productId": 2, "quantity": 1}
  ],
  "shippingAddress": "123 Main St",
  "phone": "+1234567890"
}

# 4. –û—á–∏—Å—Ç–∏—Ç—å –∫–æ—Ä–∑–∏–Ω—É
DELETE /cart/user/1/clear
```

### –°—Ü–µ–Ω–∞—Ä–∏–π 3: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∑–∞–∫–∞–∑–∞

```bash
# 1. –°–æ–∑–¥–∞—Ç—å –∑–∞–∫–∞–∑
POST /orders {...}
# –û—Ç–≤–µ—Ç: id = 1, status = "pending"

# 2. –ù–∞—á–∞—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É
PUT /orders/1
{"status": "processing"}

# 3. –û—Ç–ø—Ä–∞–≤–∏—Ç—å –∑–∞–∫–∞–∑
PUT /orders/1
{"status": "shipped"}

# 4. –ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å –¥–æ—Å—Ç–∞–≤–∫—É
PUT /orders/1
{"status": "delivered"}
```

### –°—Ü–µ–Ω–∞—Ä–∏–π 4: –û—Ç–º–µ–Ω–∞ –∑–∞–∫–∞–∑–∞

```bash
# –û—Ç–º–µ–Ω–∏—Ç—å –∑–∞–∫–∞–∑
PUT /orders/1
{"status": "cancelled"}

# –ü—Ä–∏–º–µ—á–∞–Ω–∏–µ: Stock –ù–ï –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
# –≠—Ç–æ –Ω—É–∂–Ω–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –æ—Ç–¥–µ–ª—å–Ω–æ
```

## üö® –í–∞–∂–Ω—ã–µ –∑–∞–º–µ—á–∞–Ω–∏—è

### –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ—Å—Ç–∞—Ç–∫–∞–º–∏

- ‚úÖ Stock —É–º–µ–Ω—å—à–∞–µ—Ç—Å—è –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –∑–∞–∫–∞–∑–∞
- ‚ö†Ô∏è Stock –ù–ï –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è –ø—Ä–∏ –æ—Ç–º–µ–Ω–µ –∑–∞–∫–∞–∑–∞ (–Ω—É–∂–Ω–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å)
- ‚ö†Ô∏è Stock –ù–ï —Ä–µ–∑–µ—Ä–≤–∏—Ä—É–µ—Ç—Å—è –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –≤ –∫–æ—Ä–∑–∏–Ω—É

### –ö–æ—Ä–∑–∏–Ω–∞

- –ö–æ—Ä–∑–∏–Ω–∞ —Å–æ–∑–¥–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ —Ç–æ–≤–∞—Ä–∞
- –û–¥–Ω–∞ –∫–æ—Ä–∑–∏–Ω–∞ –Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (user_id —É–Ω–∏–∫–∞–ª—å–Ω—ã–π)
- –ö–æ—Ä–∑–∏–Ω–∞ –Ω–µ –æ—á–∏—â–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞–∫–∞–∑–∞

### –¶–µ–Ω—ã

- –¶–µ–Ω–∞ —Ñ–∏–∫—Å–∏—Ä—É–µ—Ç—Å—è –≤ –º–æ–º–µ–Ω—Ç —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞–∫–∞–∑–∞
- –ò–∑–º–µ–Ω–µ–Ω–∏–µ —Ü–µ–Ω—ã —Ç–æ–≤–∞—Ä–∞ –ù–ï –≤–ª–∏—è–µ—Ç –Ω–∞ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –∑–∞–∫–∞–∑—ã
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ü–µ–Ω–∞ —Å–æ —Å–∫–∏–¥–∫–æ–π, –µ—Å–ª–∏ –æ–Ω–∞ –µ—Å—Ç—å

## üìö –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

- [MICROSERVICES.md](./MICROSERVICES.md) - –û–±—â–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø–æ –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–∞–º
- [ARCHITECTURE.md](./ARCHITECTURE.md) - –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å–∏—Å—Ç–µ–º—ã
- [MICROSERVICES-STATUS.md](./MICROSERVICES-STATUS.md) - –°—Ç–∞—Ç—É—Å –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤

## üêõ Troubleshooting

### –ó–∞–∫–∞–∑ –Ω–µ —Å–æ–∑–¥–∞–µ—Ç—Å—è

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞–ª–∏—á–∏–µ —Ç–æ–≤–∞—Ä–∞ –Ω–∞ —Å–∫–ª–∞–¥–µ
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ Product Service –∑–∞–ø—É—â–µ–Ω
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ Order Service
4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ RabbitMQ

### –ö–æ—Ä–∑–∏–Ω–∞ –ø—É—Å—Ç–∞—è –ø–æ—Å–ª–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ —Ç–æ–≤–∞—Ä —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞–ª–∏—á–∏–µ –Ω–∞ —Å–∫–ª–∞–¥–µ
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ Order Service

### Stock –Ω–µ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ Product Service –∑–∞–ø—É—â–µ–Ω
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ RabbitMQ
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –æ–±–æ–∏—Ö —Å–µ—Ä–≤–∏—Å–æ–≤

### –°–µ—Ä–≤–∏—Å –Ω–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è

```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å Docker –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã
docker ps

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏
npm run start:order:dev

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å RabbitMQ
docker logs marketplace_rabbitmq
```

## üîÆ –ë—É–¥—É—â–∏–µ —É–ª—É—á—à–µ–Ω–∏—è

### –ü–ª–∞–Ω–∏—Ä—É–µ—Ç—Å—è –¥–æ–±–∞–≤–∏—Ç—å:

- ‚è≥ –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ stock –ø—Ä–∏ –æ—Ç–º–µ–Ω–µ –∑–∞–∫–∞–∑–∞
- ‚è≥ –†–µ–∑–µ—Ä–≤–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–æ–≤ –≤ –∫–æ—Ä–∑–∏–Ω–µ
- ‚è≥ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—á–∏—Å—Ç–∫–∞ –∫–æ—Ä–∑–∏–Ω—ã –ø–æ—Å–ª–µ –∑–∞–∫–∞–∑–∞
- ‚è≥ –ò—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π —Å—Ç–∞—Ç—É—Å–∞ –∑–∞–∫–∞–∑–∞
- ‚è≥ –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ–± –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Å—Ç–∞—Ç—É—Å–∞
- ‚è≥ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å PromoCode Service –¥–ª—è –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è —Å–∫–∏–¥–æ–∫
- ‚è≥ –†–∞—Å—á–µ—Ç —Å—Ç–æ–∏–º–æ—Å—Ç–∏ –¥–æ—Å—Ç–∞–≤–∫–∏
- ‚è≥ –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –∞–¥—Ä–µ—Å–æ–≤ –¥–æ—Å—Ç–∞–≤–∫–∏
- ‚è≥ –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –∑–∞–∫–∞–∑–∞ (tracking)
- ‚è≥ –í–æ–∑–≤—Ä–∞—Ç—ã –∏ –æ–±–º–µ–Ω—ã

---

**–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è:** 24 –æ–∫—Ç—è–±—Ä—è 2025  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ì–æ—Ç–æ–≤–æ –∏ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–æ  
**Emoji:** üõí
