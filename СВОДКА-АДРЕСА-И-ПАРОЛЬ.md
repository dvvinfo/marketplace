# –°–≤–æ–¥–∫–∞: –ê–¥—Ä–µ—Å–∞ –∏ —Å–º–µ–Ω–∞ –ø–∞—Ä–æ–ª—è

## –í—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ –∑–∞–¥–∞—á–∏

### 1. ‚úÖ –°–º–µ–Ω–∞ –ø–∞—Ä–æ–ª—è (AUTH_CHANGE_PASSWORD)

**–ë—ç–∫–µ–Ω–¥:**
- –î–æ–±–∞–≤–ª–µ–Ω DTO `ChangePasswordDto` –≤ user-service
- –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω –º–µ—Ç–æ–¥ `UserService.changePassword()` —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π —Å—Ç–∞—Ä–æ–≥–æ –ø–∞—Ä–æ–ª—è
- –î–æ–±–∞–≤–ª–µ–Ω –º–µ—Ç–æ–¥ `AuthService.changePassword()`
- –°–æ–∑–¥–∞–Ω –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ `AuthController` –¥–ª—è –ø–∞—Ç—Ç–µ—Ä–Ω–∞ `AUTH_CHANGE_PASSWORD`
- –ò–∑–º–µ–Ω–µ–Ω HTTP –º–µ—Ç–æ–¥ –≤ API Gateway —Å POST –Ω–∞ PUT

**–≠–Ω–¥–ø–æ–∏–Ω—Ç:** `PUT /auth/change-password`

**–¢–µ–ª–æ –∑–∞–ø—Ä–æ—Å–∞:**
```json
{
  "oldPassword": "—Ç–µ–∫—É—â–∏–π_–ø–∞—Ä–æ–ª—å",
  "newPassword": "–Ω–æ–≤—ã–π_–ø–∞—Ä–æ–ª—å"
}
```

**–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å:**
- –¢—Ä–µ–±—É–µ—Ç—Å—è JWT —Ç–æ–∫–µ–Ω
- –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–µ–∫—É—â–µ–≥–æ –ø–∞—Ä–æ–ª—è –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–∞
- –ù–æ–≤—ã–π –ø–∞—Ä–æ–ª—å —Ö–µ—à–∏—Ä—É–µ—Ç—Å—è (bcrypt, 10 —Ä–∞—É–Ω–¥–æ–≤)
- –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –¥–ª–∏–Ω–∞: 6 —Å–∏–º–≤–æ–ª–æ–≤

**–§–∞–π–ª—ã:**
- `backend/apps/user-service/src/auth/dto/change-password.dto.ts` (–Ω–æ–≤—ã–π)
- `backend/apps/user-service/src/auth/auth.controller.ts` (–æ–±–Ω–æ–≤–ª–µ–Ω)
- `backend/apps/user-service/src/auth/auth.service.ts` (–æ–±–Ω–æ–≤–ª–µ–Ω)
- `backend/apps/user-service/src/user/user.service.ts` (–æ–±–Ω–æ–≤–ª–µ–Ω)
- `backend/apps/api-gateway/src/modules/auth/auth.controller.ts` (–æ–±–Ω–æ–≤–ª–µ–Ω)

**–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:**
- `backend/test-change-password.http`
- `backend/test-change-password.ps1`
- `backend/TEST-CHANGE-PASSWORD.bat`

---

### 2. ‚úÖ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –∞–¥—Ä–µ—Å–æ–≤ —Å –±—ç–∫–µ–Ω–¥–æ–º

**–ü—Ä–æ–±–ª–µ–º–∞:** –ê–¥—Ä–µ—Å–∞ —Å–æ—Ö—Ä–∞–Ω—è–ª–∏—Å—å –≤ localStorage

**–†–µ—à–µ–Ω–∏–µ:** –ü–æ–ª–Ω–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å PostgreSQL —á–µ—Ä–µ–∑ API

**–§—Ä–æ–Ω—Ç–µ–Ω–¥:**
- –°–æ–∑–¥–∞–Ω composable `useAddresses.ts` –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å API
- –û–±–Ω–æ–≤–ª–µ–Ω –∫–æ–º–ø–æ–Ω–µ–Ω—Ç `AddressManager.vue`
- –£–¥–∞–ª–µ–Ω–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ localStorage
- –î–æ–±–∞–≤–ª–µ–Ω–∞ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –±—ç–∫–µ–Ω–¥ API
- –ê–≤—Ç–æ–∑–∞–ø–æ–ª–Ω–µ–Ω–∏–µ —Ñ–æ—Ä–º—ã –¥–∞–Ω–Ω—ã–º–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

**–ë—ç–∫–µ–Ω–¥:**
- –û–±–Ω–æ–≤–ª–µ–Ω—ã DTO –≤ user-service (–Ω–æ–≤—ã–µ –ø–æ–ª—è)
- –£–ª—É—á—à–µ–Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –≤ API Gateway
- –í—Å–µ –º–µ—Ç–æ–¥—ã –ø—Ä–æ–≤–µ—Ä—è—é—Ç `response.success`

**–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –∞–¥—Ä–µ—Å–∞:**
```typescript
{
  id: number;
  userId: number;
  fullName: string;      // –§–ò–û –ø–æ–ª—É—á–∞—Ç–µ–ª—è
  phone: string;         // –¢–µ–ª–µ—Ñ–æ–Ω
  country: string;       // –°—Ç—Ä–∞–Ω–∞
  city: string;          // –ì–æ—Ä–æ–¥
  state?: string;        // –†–µ–≥–∏–æ–Ω
  postalCode: string;    // –ò–Ω–¥–µ–∫—Å
  addressLine1: string;  // –ê–¥—Ä–µ—Å
  addressLine2?: string; // –î–æ–ø. –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
  isDefault: boolean;    // –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é
}
```

**API —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã:**
- `GET /addresses/user/:userId` - —Å–ø–∏—Å–æ–∫ –∞–¥—Ä–µ—Å–æ–≤
- `GET /addresses/user/:userId/default` - –∞–¥—Ä–µ—Å –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
- `POST /addresses` - —Å–æ–∑–¥–∞—Ç—å –∞–¥—Ä–µ—Å
- `PUT /addresses/:id/user/:userId` - –æ–±–Ω–æ–≤–∏—Ç—å –∞–¥—Ä–µ—Å
- `PATCH /addresses/:id/user/:userId/default` - —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
- `DELETE /addresses/:id/user/:userId` - —É–¥–∞–ª–∏—Ç—å –∞–¥—Ä–µ—Å

**–§–∞–π–ª—ã:**

*–§—Ä–æ–Ω—Ç–µ–Ω–¥:*
- `frontend/app/composables/useAddresses.ts` (–Ω–æ–≤—ã–π)
- `frontend/app/components/AddressManager.vue` (–æ–±–Ω–æ–≤–ª–µ–Ω)
- `frontend/ADDRESS-INTEGRATION.md` (–¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è)

*–ë—ç–∫–µ–Ω–¥:*
- `backend/apps/user-service/src/address/dto/create-address.dto.ts` (–æ–±–Ω–æ–≤–ª–µ–Ω)
- `backend/apps/user-service/src/address/dto/update-address.dto.ts` (–æ–±–Ω–æ–≤–ª–µ–Ω)
- `backend/apps/api-gateway/src/modules/address/address.service.ts` (–æ–±–Ω–æ–≤–ª–µ–Ω)

---

## –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ –æ—à–∏–±–∫–∏

### ‚ùå –û—à–∏–±–∫–∞ 404: PUT /auth/change-password
**–ü—Ä–∏—á–∏–Ω–∞:** –ë—ç–∫–µ–Ω–¥ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª POST, —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥ - PUT  
**–†–µ—à–µ–Ω–∏–µ:** –ò–∑–º–µ–Ω–µ–Ω –º–µ—Ç–æ–¥ –Ω–∞ PUT –≤ API Gateway

### ‚ùå –û—à–∏–±–∫–∞ 500: POST /addresses
**–ü—Ä–∏—á–∏–Ω–∞:** –ù–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –ø–æ–ª–µ–π DTO (street vs addressLine1)  
**–†–µ—à–µ–Ω–∏–µ:** –û–±–Ω–æ–≤–ª–µ–Ω—ã DTO –≤ user-service

---

## –ö–∞–∫ –∑–∞–ø—É—Å—Ç–∏—Ç—å

### 1. –ë—ç–∫–µ–Ω–¥
```bash
cd backend
npm run start:dev
```

### 2. –§—Ä–æ–Ω—Ç–µ–Ω–¥
```bash
cd frontend
npm run dev
```

### 3. –ü—Ä–æ–≤–µ—Ä–∫–∞
- –û—Ç–∫—Ä–æ–π—Ç–µ http://localhost:3000
- –í–æ–π–¥–∏—Ç–µ –≤ —Å–∏—Å—Ç–µ–º—É
- –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ –ø—Ä–æ—Ñ–∏–ª—å
- –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–π—Ç–µ —Å–º–µ–Ω—É –ø–∞—Ä–æ–ª—è –∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –∞–¥—Ä–µ—Å–æ–≤

---

## –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö

### –¢–∞–±–ª–∏—Ü–∞ addresses

```sql
CREATE TABLE addresses (
  id SERIAL PRIMARY KEY,
  user_id INTEGER NOT NULL,
  full_name VARCHAR NOT NULL,
  phone VARCHAR NOT NULL,
  country VARCHAR NOT NULL,
  city VARCHAR NOT NULL,
  state VARCHAR,
  postal_code VARCHAR NOT NULL,
  address_line1 VARCHAR NOT NULL,
  address_line2 VARCHAR,
  is_default BOOLEAN DEFAULT false,
  created_at TIMESTAMP DEFAULT NOW(),
  updated_at TIMESTAMP DEFAULT NOW()
);
```

---

## –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

- `backend/CHANGE-PASSWORD-IMPLEMENTATION.md` - —Å–º–µ–Ω–∞ –ø–∞—Ä–æ–ª—è (EN)
- `backend/–°–ú–ï–ù–ê-–ü–ê–†–û–õ–Ø.md` - —Å–º–µ–Ω–∞ –ø–∞—Ä–æ–ª—è (RU)
- `backend/–ó–ê–ü–£–°–ö-–ò-–¢–ï–°–¢–ò–†–û–í–ê–ù–ò–ï.md` - –∑–∞–ø—É—Å–∫ –∏ –æ—Ç–ª–∞–¥–∫–∞
- `backend/–ò–°–ü–†–ê–í–õ–ï–ù–ò–ï-–ê–î–†–ï–°–û–í.md` - –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ—à–∏–±–æ–∫ –∞–¥—Ä–µ—Å–æ–≤
- `frontend/ADDRESS-INTEGRATION.md` - –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –∞–¥—Ä–µ—Å–æ–≤

---

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –°–º–µ–Ω–∞ –ø–∞—Ä–æ–ª—è
```bash
cd backend
.\TEST-CHANGE-PASSWORD.bat
```

### –ê–¥—Ä–µ—Å–∞ (—á–µ—Ä–µ–∑ curl)
```bash
# –°–æ–∑–¥–∞—Ç—å –∞–¥—Ä–µ—Å
curl -X POST http://localhost:3001/addresses \
  -H "Content-Type: application/json" \
  -d '{
    "userId": 1,
    "fullName": "–ò–≤–∞–Ω –ò–≤–∞–Ω–æ–≤",
    "phone": "+79991234567",
    "country": "–†–æ—Å—Å–∏—è",
    "city": "–ú–æ—Å–∫–≤–∞",
    "postalCode": "123456",
    "addressLine1": "—É–ª. –õ–µ–Ω–∏–Ω–∞, –¥. 10, –∫–≤. 5",
    "isDefault": true
  }'

# –ü–æ–ª—É—á–∏—Ç—å –∞–¥—Ä–µ—Å–∞
curl http://localhost:3001/addresses/user/1
```

---

## –ì–æ—Ç–æ–≤–æ! üöÄ

–û–±–∞ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–∞ –ø–æ–ª–Ω–æ—Å—Ç—å—é —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã –∏ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω—ã:
- ‚úÖ –°–º–µ–Ω–∞ –ø–∞—Ä–æ–ª—è —Ä–∞–±–æ—Ç–∞–µ—Ç —á–µ—Ä–µ–∑ PUT /auth/change-password
- ‚úÖ –ê–¥—Ä–µ—Å–∞ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ PostgreSQL —á–µ—Ä–µ–∑ API
- ‚úÖ –í—Å–µ –æ—à–∏–±–∫–∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã
- ‚úÖ –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è —Å–æ–∑–¥–∞–Ω–∞

**–°–ª–µ–¥—É—é—â–∏–π —à–∞–≥:** –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ –±—ç–∫–µ–Ω–¥ –¥–ª—è –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π!
